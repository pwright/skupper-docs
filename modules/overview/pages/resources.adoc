:toc:
= Skupper resources on Kubernetes

The following sections describe the various Skupper resources on Kubernetes, for example, service accounts


== Service accounts, roles and role bindings

When you use the `skupper` CLI to create a {skupper-name} site, the following resources are created


skupper-service-controller:: A service account, role and role binding with this name are created to manage the {skupper-name} service controller.

skupper-router:: A service account, role and role binding with this name are created to manage the {skupper-name} router.


[NOTE]
====
To create service accounts that allow you run the `skupper` CLI, you must give those accounts permissions as described in the example below:

----
apiVersion: v1
kind: ServiceAccount
metadata:
  name: docs-west-user
  namespace: docs-west

---
kind: Role
apiVersion: rbac.authorization.k8s.io/v1beta1
metadata:
  name: docs-west-user-full-access
  namespace: docs-west
rules:
- apiGroups: ["", "apps", "extensions", "route.openshift.io", "rbac.authorization.k8s.io",]
  resources: ["*"]
  verbs: ["*"]

---
kind: RoleBinding
apiVersion: rbac.authorization.k8s.io/v1beta1
metadata:
  name: docs-west-user-view
  namespace: docs-west
subjects:
- kind: ServiceAccount
  name: docs-west-user
  namespace: docs-west
roleRef:
  apiGroup: rbac.authorization.k8s.io
  kind: Role
  name: docs-west-user-full-access

----

====

== Deployments

Each Skupper site on Kubernetes consists of two deployments:

skupper-router:: provides the data plane for the {service-network}.

skupper-service-controller:: provides 


== ConfigMaps

Do not edit these ConfigMap values directly, use the `skupper` CLI to create or change configuration.

skupper-site:: site settings, including:
+
--
* console authentication
* ingress strategy

This ConfigMap is the root object for all the skupper resources; deleting it will remove the Skupper deployment from the namespace.
--

skupper-services:: internal representation of the services available on the {service-network}.

skupper-internal:: internal router configuration.
The service controller determines the values in this ConfigMap based on the services available on the {service-network}.

== Secrets and Certificate Authorities 


Each site has two CAs:

skupper-local-ca:: issues certs for local access. 
The local certs are held in skupper-local-client and skupper-local-server. The server cert is used by the router, the client by the service controller. 


skupper-site-ca:: issues certs for remote access. 
The site ca issued certs are skupper-site-server which holds the certs that identify the router to other routers that link to this site, skupper-claims-server which identifies the claims service, which is part of the service controller and is used when another site first established a link to ecxhange a restricted use token for a tls certificate and skupper-console-certs which holds certs for the console.

// what's this about?
The first set of secrets are those holding TLS credentials. 

If using username based console authentication, there is also a skupper-console-users secret that contains the username(s) and password(s) that can be used to access the console. A username and password can be specified on skupper init. If not then an 'admin' user is generated with a generated password.


The tokens used to establish a link will also result in secrets:

* The site that issues a token (of type claim) will have a secret with a uuid as name that contains details of any usage restrictions (how many times it can still be used and when it expires). 

* The site establishing the link will have a token generally called link1, link2 etc that contains the token claim or certificate.


== Services

In addition to the services that are exposed on the {service-network}, the following services are created:

skupper-router-local:: This service is used by the service controller to connect to the router in order to configure it and get statistics. 
The skupper-router service is used to access the router over the inter-router or edge ports, and is what is used by other sites that link to this one, though there may be e.g. an ingress in front of that. 

skupper:: This service is for access to the service-controller,
specifically the console and the claims-server.

